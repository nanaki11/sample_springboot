# Flyway DBマイグレーション


## Flyway とは
- DB の状態をバージョン管理する為のツール


## マイグレーション実行方法
- SpringBootを起動すると、自動でマイグレーションが実行される。
- 実行対象は、src.main.resources.db.migration配下のSQLファイル。


## 本プロジェクトにおける開発時の運用方法
- テーブル定義変更時に、R__create_all_tables.sql を変更してコミットする。
- 対応するentityもセットでコミットすること！


## 困ったときは
- flyway_schema_historyテーブルのレコードを削除してみる
- flyway_schema_historyテーブル自体を削除してみる


## 本来の運用方法
- SQLのファイル名先頭にバージョンをつける。例えば`V1.0.0_create_table.sql`など。
- DBに変更があった場合は、差分（ALTER文など）をバージョンを上げたファイル（`V1.0.1_alter_usertable.sql`など）で作成する。
- Flywayではどのバージョンまでを実行したか、flyway_schema_historyに保存しており、まだ未実行のファイルを自動で実行してくれる。
- `R_～`のファイル名は、リピータブルマイグレーションファイルと呼ばれるもので、本来はビュー、プロシージャ、ファンクションなどは変更内容を差分のファイルとして表現できないものを管理するためのファイル。
- 開発時は差分管理が面倒なので、一律再実行させるためにリピータブルを利用している
